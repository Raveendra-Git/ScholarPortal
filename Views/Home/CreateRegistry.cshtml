
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="shortcut icon" type="image/x-icon" href="~/Images/favicon.png" />
    <title>Create Registry</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/select2.css" rel="stylesheet" />
    <link href="~/Content/toast.css" rel="stylesheet" />
    <link href="~/Content/Custom/Style.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-datepicker.css" rel="stylesheet" />
    <style>
        .form-control {
            border: 1px solid #000;
            border-radius: 0px;
        }

        .container {
            max-width: inherit !important;
        }

        .card {
            margin: 10px;
            background-color: white;
            font-size: larger;
        }

        body {
            background-color: aliceblue;
        }

        .position-relative {
            position: relative;
            float: right !important;
        }

        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-body">
                <form id="form-register" method="post" novalidate>

                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row main-page">
                                <div class="col-sm-6">

                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label class="control-label">First Name<span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="text" name="name" id="txtfName" class="form-control" data-validation-required-message="First Name is required" required aria-invalid="false" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label class="control-label">Last Name <span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="text" name="name" id="txtlName" class="form-control" value="" data-validation-required-message="Last Name is required" required />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>DOB<span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input id="dtDOB" class="form-control clstxtfield-md" type="text" data-validation-required-message="DOB is required" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>Email <span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="email" name="email" id="txtEmail" class="form-control" value="" data-validation-required-message="Email is required" required />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>Phone No : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <input type="number" name="number" id="txtPhNo" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>Gender : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <input type="radio" name="gender" id="male" value="1" />
                                                    <label for="male">Male</label>
                                                    <input type="radio" name="gender" id="female" value="2" />
                                                    <label for="female">Female</label>
                                                    <input type="radio" name="gender" id="other" value="0" />
                                                    <label for="other">Other</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>Languages known : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <input type="checkbox" name="language" value="1" id="english" />
                                                    <label for="english">English</label>
                                                    <input type="checkbox" name="language" value="2" id="kannada" />
                                                    <label for="kannada">Kannada</label>
                                                    <input type="checkbox" name="language" value="3" id="hindi" />
                                                    <label for="hindi">Hindi</label>
                                                    <input type="checkbox" name="language" value="4" id="telugu" />
                                                    <label for="telugu">Telugu</label>
                                                    <input type="checkbox" name="language" value="5" id="chkother" />
                                                    <label for="chkother">Other</label>
                                                    <input type="text" name="language" id="txtOtherChkbx" class="clscheck" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>Address : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <textarea placeholder="Address..." rows="3" cols="41" id="txtAddress" class="form-control"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6" style=" background-color: ghostwhite;">
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>User Type<span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <select class="form-control" id="ddlUserType">
                                                        <option value="0">Select</option>
                                                        <option value="1">Admin</option>
                                                        <option value="2">Staff</option>
                                                        <option value="3">Student</option>
                                                        <option value="4">Co-ordinators</option>
                                                        <option value="5">Others</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group specialization" style="display:none">
                                        <div class="col-sm-8 ">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>Specialization<span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <select class="form-control" id="ddlSubjectsType">
                                                        <option value="0">Select</option>
                                                        <option value="1" selected>General Knowledge</option>
                                                        <option value="2">Cyber Security</option>
                                                        <option value="3">Politics</option>
                                                        <option value="4">Pshychology</option>
                                                        <option value="5">Philontrophy</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>UserId <span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="text" name="UserId" id="txtUserId" class="form-control" value="" data-validation-required-message="UserId is required" required />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>Password <span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="password" name="password" id="txtPassword" value="" class="form-control" data-validation-required-message="Password is required" required />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row control-group">
                                                <div class="col-sm-4">
                                                    <label>Confirm Password <span class="text-danger">*</span> : </label>
                                                </div>
                                                <div class="col-sm-8 controls">
                                                    <input type="password" name="password" id="txtConfirmPass" value="" class="form-control" data-validation-required-message="Confirm Password is required" required />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>Country : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <select id="ddlCounty" onchange="fnBindStates();" class="form-control clsSelect">
                                                        <option value="0">Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row form-group">
                                        <div class="col-sm-8">
                                            <div class="row">
                                                <div class="col-sm-4">
                                                    <label>State : </label>
                                                </div>
                                                <div class="col-sm-8">
                                                    <select id="ddlState" class="form-control">
                                                        <option value="">Select State</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-sm-12 upload-img">
                                            <div class="row">
                                                <div class="col-sm-3">
                                                    <label>Picture : </label>
                                                </div>
                                                <div class="col-sm-9">
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <input style="margin-left:-21px;" type="file" name="txtPicture" id="txtPicture" />
                                                            @*  <input type="file" id="myFile" name="myFile" />*@
                                                            <asp:Button runat="server" ID="btnUpload" Text="Upload" />
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="img-responsive">
                                                                <img id="user_img" height="120" width="120" style="border:solid;display:none" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group position-relative">
                                        <input type="reset" name="button" value="Reset" class="btn btn-primary clsbtn" onclick="fnReset();" />
                                        <input type="submit" name="button" value="Save" class="btn btn-primary clsbtn" />
                                        <input type="button" name="button" id="btnUpload" value="Upload Profile" class="btn btn-success clsbtn1 hide" onclick="fnUploadDoc();" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
    <input type="hidden" name="name" id="hidParticipantID" value="" />

    <script src="~/Scripts/jquery-3.5.1.min.js"></script>
    <script src="~/Scripts/jqBootstrapValidation.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/select2.js"></script>
    <script src="~/Scripts/bootstrap-datepicker.js"></script>
    <script src="~/Scripts/toast.js"></script>
    <script>
        $(function () {
            $("input,select,textarea").jqBootstrapValidation(
                {
                    preventSubmit: true,
                    submitError: function ($form, event, errors) {
                        //alert("Not Valid!!");
                    },
                    submitSuccess: function ($form, event) {
                        event.preventDefault();
                        fnSave();
                    },
                    filter: function () {
                        return $(this).is(":visible");
                    }
                }
            );

            $("#ddlCounty,#ddlState").select2();
            $('#dtDOB').datepicker({
                format: "dd/mm/yyyy",
                endDate: "currentDate",
                autoclose: true
            });
            $("#txtPicture").change(function () {
                var length = this.files.length;
                if (!length) {
                    return false;
                }
                useImage(this);
            });

            fnloadCountry();
        });

        function fnReset() {
            $('#form-register')[0].reset();
            $('.clsSelect').val(0);
            $('#hidParticipantID').val('');
        }

        function fnloadCountry() {
            $.post('/Home/GetCountryNames', {}, function (data) {
                var objCounty = data.countries;
                if (objCounty != undefined && objCounty.length > 0) {
                    $('#ddlCounty').find('option').remove();
                    $('#ddlCounty').append('<option value="">Select</option>');
                    var optionhtml = "";
                    $.each(objCounty, function (e) {
                        optionhtml = '<option value="' + objCounty[e].ID + '">' + objCounty[e].CountryName + '</option>';
                        $('#ddlCounty').append(optionhtml);
                    });
                } else {
                    $('#ddlCounty').append('<option value="">--Select Country..</option>');
                }
            });
        }

        function fnBindStates() {
            $.post('/Home/GetStateNames', { CountryID: $('#ddlCounty').val() }, function (data) {
                var objState = data.states;
                if (objState != undefined && objState.length > 0) {
                    $('#ddlState').find('option').remove();
                    var optionhtml = "";
                    $.each(objState, function (s) {
                        //var statenm = $.trim(objState[s].StateName.toLowerCase().replace(/\s/g, ''));
                        optionhtml = '<option value="' + objState[s].ID + '">' + objState[s].StateName + '</option>';
                        $('#ddlState').append(optionhtml);
                    });
                } else {
                    $('#ddlState').append('<option value="">--Select State--</option>');
                }

            });
        }

        function fnSave() {
            var lang = new Array();
            $("input[type=checkbox]").each(function () {
                if ($(this).is(":checked"))
                    lang.push($(this).val())
            });

            var formdata = {
                FirstName: $('#txtfName').val(),
                LastName: $('#txtlName').val(),
                DOB: $('#dtDOB').val(),
                Email: $('#txtEmail').val(),
                PhoneNo: $('#txtPhNo').val(),
                Gender: $('input[name="gender"]:checked').val(),
                Language: lang.join(","),//$("input[name='language']:checked").val(),
                OtherLanguage: $('#txtOtherChkbx').val(),
                Address: $('#txtAddress').val(),
                UserType: $('#ddlUserType').val(),
                UserId: $('#txtUserId').val(),
                Password: $('#txtPassword').val(),
                ConfirmPassword: $('#txtConfirmPass').val(),
                Country: $('#ddlCounty').val(),
                State: $('#ddlState').val(),
                file: $('#user_img').attr('src').replace('data:image/', '').replace(/png|jpg|jpeg|bmp|tiff|gif/, '').replace(';base64,', ''),
                Picture: document.getElementById('txtPicture').files[0].name
            }

            $.ajax({
                url: '/Home/SaveRegistry',
                type: 'POST',  // http method
                data: formdata,  // data to submit
                success: function (data, status, xhr) {
                    console.log('status: ' + status + ', data: ' + data);
                    if (data != "0") {
                        $.toast({ heading: 'Successfully Registered.', position: 'top-right', icon: 'success', hideAfter: 6000, stack: 6 });
                        $("#hidParticipantID").val(data);
                        window.location = "/Home/Index";
                    } else {
                        $.toast({ heading: 'Error on Saving!.', position: 'top-right', icon: 'error', hideAfter: 6000, stack: 6 });
                    }
                },
                error: function (jqXhr, textStatus, errorMessage) {
                    console.log('Error' + errorMessage);
                }
            });
        }

        function fnUploadDoc() {
            debugger;
            // var formdata = new FormData();
            //formdata.append("Base64string", $('#user_img').attr('src').replace('data:image/', '').replace(/png|jpg|jpeg|bmp|tiff|gif/, '').replace(';base64,', ''));
            //formdata.append("ID", $("#hidParticipantID").val());

            var formdata = {
                file: document.getElementById('txtPicture').files[0].name,
                file: $('#user_img').attr('src').replace('data:image/', '').replace(/png|jpg|jpeg|bmp|tiff|gif/, '').replace(';base64,', ''),
                Picture: document.getElementById('txtPicture').files[0].name,
                ParticipantID: $("#hidParticipantID").val(),
                ID: $("#hidParticipantID").val()
            }
            debugger;
            $.post('/Home/UploadProfile', formdata, function (data) {
                debugger;
                if (data != "0") {
                    $.toast({ heading: 'Profile Image Updated Successfully.', position: 'top-right', icon: 'success', hideAfter: 6000, stack: 6 });
                    debugger
                    //$("#hidParticipantID").val(data);
                    window.location = "../Home/Index";
                    //$(".main-page").hide();
                    //$(".Picture-page").show();
                }
            });
        }

        // function to display image
        function useImage(img) {
            var file = img.files[0];
            var imagename = file.name;
            var imagefile = file.type;

            var match = ["image/jpeg", "image/png", "image/jpg"];
            if (!((imagefile == match[0]) || (imagefile == match[1]) || (imagefile == match[2]))) {
                //alert("Invalid File Extension");
                $.toast({ heading: 'Invalid File Extension.', position: 'top-right', icon: 'error', hideAfter: 6000, stack: 6 });

            } else {
                var reader = new FileReader;
                var image = new Image;
                reader.readAsDataURL(file);

                reader.onload = function (_file) {

                    image.src = _file.target.result;
                    image.onload = function () {

                        var height = this.height;
                        var width = this.width;
                        var size = (this.size / 1023) + "KB";
                        $('#user_img').attr('src', _file.target.result).css('display', 'block');
                    }
                }
            }
        }
    </script>
</body>
</html>
